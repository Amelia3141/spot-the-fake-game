<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spot The Fake</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f5f5f5 0%, #e8f5e9 100%); color: #333; padding: 20px; min-height: 100vh; }
        .container { max-width: 800px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        h1 { font-size: 32px; margin-bottom: 5px; }
        h2 { font-size: 24px; margin-bottom: 15px; }
        .subtitle { color: #666; font-size: 14px; }
        .score { text-align: right; }
        .score-label { font-size: 12px; color: #999; }
        .score-value { font-size: 36px; font-weight: bold; }
        .card { background: white; border: 2px solid #4caf50; border-radius: 12px; padding: 30px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .round-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .round-title { font-size: 20px; font-weight: bold; }
        .round-number { background: #4caf50; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; }
        .instructions { color: #666; margin-bottom: 20px; font-size: 14px; }
        .facts { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
        .fact { padding: 20px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; transition: all 0.3s; text-align: left; background: white; }
        .fact:hover:not(.disabled) { border-color: #4caf50; }
        .fact.selected { background: #e8f5e9; border-color: #4caf50; }
        .fact.correct { background: #e8f5e9; border-color: #4caf50; }
        .fact.wrong { background: #ffebee; border-color: #f44336; }
        .fact.disabled { cursor: not-allowed; }
        .fact-name { font-weight: bold; font-size: 16px; margin-bottom: 8px; color: #ff9800; }
        .fact-desc { font-size: 14px; color: #555; line-height: 1.5; }
        .fact-badge { display: inline-block; margin-top: 10px; padding: 6px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; color: white; }
        .badge-fake { background: #f44336; }
        .badge-real { background: #4caf50; }
        .explanation { background: #f0f7e8; border: 1px solid #4caf50; border-radius: 8px; padding: 15px; margin-bottom: 20px; display: none; }
        .explanation.show { display: block; }
        .explanation-title { font-weight: bold; margin-bottom: 8px; }
        .explanation-text { font-size: 14px; line-height: 1.6; color: #333; }
        button { background: linear-gradient(135deg, #ff9800 0%, #4caf50 100%); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; width: 100%; }
        button:hover { transform: translateY(-2px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .game-over { text-align: center; }
        .final-score { font-size: 64px; font-weight: bold; color: #4caf50; margin: 20px 0; }
        .message { font-size: 18px; margin-bottom: 20px; }
        .lesson { background: #fff3e0; border: 2px solid #ff9800; border-radius: 8px; padding: 15px; margin-top: 20px; font-size: 13px; }
        .difficulty-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .difficulty-btn { padding: 12px; font-size: 14px; }
        .difficulty-btn.active { background: #4caf50; }
        .difficulty-btn.inactive { background: #ddd; color: #333; }
        .difficulty-btn:hover { transform: none; }
        .menu-section { margin-bottom: 30px; }
        .difficulty-desc { font-size: 12px; color: #666; margin-top: 10px; }
        .error-message { color: #f44336; font-size: 12px; margin-top: 5px; }
        input { font-family: inherit; }
        @media (max-width: 600px) {
            .header { flex-direction: column; text-align: center; }
            .score { margin-top: 15px; }
            h1 { font-size: 24px; }
            .difficulty-grid { grid-template-columns: 1fr; }
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <div id="game"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCUdAqlDwN_1lRlbBHaA37RPscAtuxIXTA",
            authDomain: "spot-fake-game.firebaseapp.com",
            databaseURL: "https://spot-fake-game-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "spot-fake-game",
            storageBucket: "spot-fake-game.firebasestorage.app",
            messagingSenderId: "141455787893",
            appId: "1:141455787893:web:e94feb2716c98336f1753c"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // NAME VALIDATION
        const blockedWords = [
            'f4g', 'fagg', 'n1gg', 'nigg', 'sh1t', 'shitt', 
            'kys', 'kill', 'die', 'slut', 'whore', 'cunt'
        ];

        const whitelistedNames = [
            'assana', 'assane', 'shaniqua', 'gaylord', 'dick', 'dickson', 
            'fanny', 'fannie', 'shitley', 'damn', 'dammit', 'ass'
        ];

        function isNameValid(name) {
            const lower = name.toLowerCase().trim();
            
            if (lower.length < 2 || lower.length > 30) {
                return { valid: false, reason: 'Name must be 2-30 characters' };
            }
            
            for (let word of blockedWords) {
                if (lower.includes(word)) {
                    return { valid: false, reason: 'Name contains restricted content' };
                }
            }
            
            const profanityPatterns = [
                { regex: /shit/i, safe: false },
                { regex: /fuck/i, safe: false },
                { regex: /damn/i, safe: false },
                { regex: /ass(?!ana|ane)/i, safe: false },
                { regex: /dick(?!inson|son)/i, safe: false },
                { regex: /dick$/i, safe: true },
                { regex: /fanny$/i, safe: true },
                { regex: /^hell/i, safe: false },
                { regex: /bitch/i, safe: false }
            ];
            
            for (let pattern of profanityPatterns) {
                if (pattern.regex.test(lower)) {
                    const isWhitelisted = whitelistedNames.some(wl => 
                        lower === wl.toLowerCase() || lower.includes(wl.toLowerCase())
                    );
                    if (!isWhitelisted && !pattern.safe) {
                        return { valid: false, reason: 'Name contains restricted content' };
                    }
                }
            }
            
            if (/(.)\1{4,}/.test(lower)) {
                return { valid: false, reason: 'Name contains too many repeated characters' };
            }
            
            if (!/[a-z]/i.test(lower)) {
                return { valid: false, reason: 'Name must contain at least one letter' };
            }
            
            return { valid: true };
        }

        let state = {
            gameStarted: false,
            mode: null,
            difficulty: 'medium',
            round: 0,
            score: 0,
            selected: null,
            revealed: false,
            complete: false,
            playerName: null,
            leaderboard: [],
            nameError: ''
        };

        // CALL MY BLUFF - EASY MODE
const roundsEasy = [
    {
        title: "Round 1: Clear Definitions",
        pairs: [
            {
                condition: "Color Blindness",
                real: "An inability to see certain colors, usually reds and greens. People perceive the world in different shades but live completely normal lives.",
                fake: "A condition where all colors appear as shades of gray and vision is identical to old black and white movies.",
                correctIsReal: true
            }
        ],
        explain: "Color blindness doesn't mean seeing in black and white. Most people with this condition see colors, just differently than others."
    },
    {
        title: "Round 2: Sleep Issues",
        pairs: [
            {
                condition: "Insomnia",
                real: "Difficulty falling asleep or staying asleep despite having the opportunity. Very common and affects millions of people.",
                fake: "The brain's inability to enter sleep mode, resulting in permanent wakefulness with no fatigue ever being felt.",
                correctIsReal: true
            }
        ],
        explain: "Insomnia involves struggling to sleep, not losing the ability to feel tired. People with insomnia still experience tiredness—they just can't sleep."
    },
    {
        title: "Round 3: Head and Pain",
        pairs: [
            {
                condition: "Migraine",
                real: "A severe headache typically on one side of the head, often accompanied by nausea or light sensitivity. Episodes last hours or days.",
                fake: "A neurological condition where the brain physically shrinks and shifts position inside the skull, causing excruciating pain.",
                correctIsReal: true
            }
        ],
        explain: "Migraines are intense headaches caused by blood vessel and nerve activity. Brain shrinkage would cause severe damage—migraines don't work that way."
    },
    {
        title: "Round 4: Balance and Dizziness",
        pairs: [
            {
                condition: "Vertigo",
                real: "A sensation of spinning or the room spinning around you. Often caused by inner ear problems or sudden position changes.",
                fake: "An extreme fear response to heights that prevents looking downward and makes climbing impossible.",
                correctIsReal: true
            }
        ],
        explain: "Vertigo is the spinning sensation itself. Fear of heights is called acrophobia—completely different conditions with different causes."
    }
];

// CALL MY BLUFF - MEDIUM MODE
const roundsMedium = [
    {
        title: "Round 1: Name Tricks",
        pairs: [
            {
                condition: "Cooley's Anemia",
                real: "A genetic blood disorder where the body cannot produce enough healthy red blood cells. Named after Dr. Thomas Cooley who first described it in 1925. Common in Mediterranean populations.",
                fake: "A disorder caused by prolonged exposure to cold temperatures, where red blood cells freeze and break down. Named after Dr. James Cooley's Arctic research expeditions.",
                correctIsReal: true
            }
        ],
        explain: "Cooley's Anemia is named after the doctor, not the temperature. The fake version tricks you by interpreting 'Cooley' as 'cool' = cold."
    },
    {
        title: "Round 2: Misleading Names",
        pairs: [
            {
                condition: "Down Syndrome",
                real: "A genetic condition caused by an extra chromosome 21. Named after Dr. John Langdon Down who first identified it in 1866. Unrelated to emotional state.",
                fake: "A mood disorder where people experience constant emotional depression and downward spirals requiring permanent isolation.",
                correctIsReal: true
            }
        ],
        explain: "Down Syndrome is named after Dr. Down, not emotion. The fake exploits the word 'down' to suggest it's a depression disorder."
    },
    {
        title: "Round 3: Medical Terms",
        pairs: [
            {
                condition: "Long Q-T Syndrome",
                real: "A heart rhythm disorder where electrical signals take longer to reset between heartbeats. The 'Q-T' refers to segments visible on an EKG graph. Can cause fainting and sudden cardiac death.",
                fake: "A syndrome where quantum tunneling in neural synapses causes delayed thought processes and extreme slowness. 'Q-T' stands for Quantum Tunneling.",
                correctIsReal: true
            }
        ],
        explain: "Long Q-T Syndrome is about electrical timing on heart monitors, not quantum physics. The fake mixes real medical terms with made-up quantum biology."
    },
    {
        title: "Round 4: Doctor Names",
        pairs: [
            {
                condition: "Diamond-Blackfan Anemia",
                real: "A rare bone marrow disorder where the body cannot produce enough red blood cells. Named after doctors Louis Diamond and Kenneth Blackfan who described it in 1938.",
                fake: "A precious metal poisoning disorder where diamond dust and blackfan mineral deposits accumulate in bone marrow, seen in jewelers and miners.",
                correctIsReal: true
            }
        ],
        explain: "Diamond-Blackfan Anemia is named after two doctors. The fake tricks you by treating 'diamond' and 'blackfan' as if they were the toxic cause."
    }
];

// CALL MY BLUFF - HARD MODE
const roundsHard = [
    {
        title: "Round 1: Expert Misconceptions",
        pairs: [
            {
                condition: "Marfan Syndrome",
                real: "A genetic disorder affecting connective tissue, caused by mutations in the fibrillin-1 gene. Affects skeleton, lungs, eyes, and heart. Named after Antoine Marfan who described it in 1896.",
                fake: "A condition where body cells multiply uncontrollably in spider-web patterns, causing extremely rapid growth and early death. Discovered by Mars rovers analyzing lunar samples.",
                correctIsReal: true
            }
        ],
        explain: "Marfan Syndrome is a connective tissue disorder from genetic mutations. The fake invents an implausible mechanism and absurdly claims moon discovery."
    },
    {
        title: "Round 2: Similar-Sounding Conditions",
        pairs: [
            {
                condition: "Ehlers-Danlos Syndrome",
                real: "A group of genetic disorders affecting collagen production. Causes unusually flexible joints, stretchy skin, and fragile connective tissue. Named after two dermatologists who identified it.",
                fake: "A syndrome where the nervous system mistakes electrical signals and sends them backward through the spine, causing inverted sensations where cold feels hot.",
                correctIsReal: true
            }
        ],
        explain: "EDS affects collagen structure. The fake describes fictional neurological inversion that doesn't exist in any known condition."
    },
    {
        title: "Round 3: Real Conditions with Tricky Names",
        pairs: [
            {
                condition: "SUNCT Syndrome",
                real: "Short Unilateral Neuralgiform headache attacks with Conjunctival injection and Tearing. Causes sudden, severe headaches on one side with eye symptoms. Abbreviated from the medical acronym.",
                fake: "Sustained Unilateral Neural Compression Tissue syndrome where nerves on one side are permanently pinched, causing complete paralysis within months.",
                correctIsReal: true
            }
        ],
        explain: "SUNCT is a real headache disorder. The fake creates a made-up acronym describing permanent paralysis—a completely different pathology."
    },
    {
        title: "Round 4: Deceptively Complex",
        pairs: [
            {
                condition: "Hereditary Angioedema",
                real: "A rare genetic disorder affecting a blood protein (C1 esterase inhibitor). Causes unpredictable swelling in skin and internal organs. Can be life-threatening during throat swelling.",
                fake: "A condition where the body develops severe allergic reactions to inherited family traits, causing swelling that worsens with each generation until suffocation.",
                correctIsReal: true
            }
        ],
        explain: "HAE is a protein deficiency disorder. The fake suggests allergies to 'family traits' and progressive generational worsening—nonsensical pseudoscience."
    }
];

// SPOT THE FAKE - EASY MODE
const spotFakeRoundsEasy = [
    {
        title: "Round 1: Body Basics",
        facts: [
            { name: "Sneezing", desc: "An automatic response to irritants in the nose. Expels air at high speed to clear the airway.", fake: false },
            { name: "Hiccups", desc: "Involuntary spasms of the diaphragm muscle. The body's method of clearing the airway.", fake: false },
            { name: "WiFi Hearing Syndrome", desc: "A condition where people hear WiFi signals as a high-pitched buzzing sound in their ears. Affects 15% of the population.", fake: true },
            { name: "Yawning", desc: "A reflexive action involving deep inhalation. Often occurs when tired or bored.", fake: false }
        ],
        explain: "WiFi Hearing Syndrome is made up. WiFi uses radio waves—humans cannot hear radio waves. The fake uses a made-up percentage to sound credible."
    },
    {
        title: "Round 2: Eyes and Sight",
        facts: [
            { name: "Blinking", desc: "Automatic closing and opening of eyelids. Keeps eyes moist and clean.", fake: false },
            { name: "Goosebumps", desc: "Tiny muscles at hair roots contract, usually from cold or emotion. Leftover from when humans had more body hair.", fake: false },
            { name: "Color-Sound Synesthesia", desc: "The tongue changes color based on sounds heard. Loud noises turn it blue, soft sounds turn it pink.", fake: true },
            { name: "Sweating", desc: "The body releases water through skin to cool down when hot or nervous.", fake: false }
        ],
        explain: "Color-Sound Synesthesia is fake—tongues don't change color based on sounds. Real synesthesia involves senses mixing (like seeing colors when hearing music)."
    },
    {
        title: "Round 3: Digestive System",
        facts: [
            { name: "Coughing", desc: "The lungs expel air forcefully to clear the airway of irritants or mucus.", fake: false },
            { name: "Hunger", desc: "The stomach signals the brain when empty and needing food. Felt as a growling sensation.", fake: false },
            { name: "Reverse Digestion Syndrome", desc: "Food travels backward through the digestive system, slowly rising back up the throat over several hours.", fake: true },
            { name: "Tiredness", desc: "The brain and body's signal that they need rest. Happens after activity or long wakefulness.", fake: false }
        ],
        explain: "Reverse Digestion Syndrome is completely made up. The digestive system doesn't work backward—gravity and muscles only push food downward."
    },
    {
        title: "Round 4: Emotions and Sleep",
        facts: [
            { name: "Crying", desc: "An emotional response where tears flow from the eyes. Can occur from sadness, joy, or irritants like onions.", fake: false },
            { name: "Dizziness", desc: "A sensation of spinning or feeling off-balance. Usually from inner ear problems or quick position changes.", fake: false },
            { name: "Memory Inversion Disorder", desc: "Memories are retained in perfect detail but in completely random order, making life confusing despite perfect memory recall.", fake: true },
            { name: "Sleepiness", desc: "The body's signal that it needs rest. Typically happens at night or after physical activity.", fake: false }
        ],
        explain: "Memory Inversion Disorder doesn't exist. If memories were random, you wouldn't recognize events or people—that's amnesia, not 'random order.'"
    }
];

// SPOT THE FAKE - MEDIUM MODE
const spotFakeRoundsMedium = [
    {
        title: "Round 1: Warming Up",
        facts: [
            { name: "Brain Freeze", desc: "A sharp headache from eating ice cream too fast occurs when cold hits the roof of the mouth. Blood vessels rapidly constrict then dilate, triggering pain signals.", fake: false },
            { name: "Exploding Head Syndrome", desc: "Loud explosion sounds or crashes occur inside the head when falling asleep or waking up. Completely harmless but very frightening.", fake: false },
            { name: "Sonic Perception Syndrome", desc: "People hear electrical frequencies from power lines and WiFi routers, causing constant humming sensations. Affects roughly 2.3% of the population and worsens with age.", fake: true },
            { name: "Hiccups", desc: "Involuntary spasms of the diaphragm muscle followed by sudden closure of the vocal cords. The longest recorded case lasted 68 years.", fake: false }
        ],
        explain: "Sonic Perception Syndrome is AI-generated. Red flags: suspiciously specific percentage (2.3%), made-up name combining real medical words, no mechanism explained."
    },
    {
        title: "Round 2: Getting Tricky",
        facts: [
            { name: "Thunderclap Headache", desc: "A sudden, severe headache reaching maximum intensity within 60 seconds. Often described as 'the worst headache of your life.' Can signal bleeding in the brain.", fake: false },
            { name: "Mirror Touch Synesthesia", desc: "Some people physically feel sensations they observe others experiencing. Watching someone being touched on the arm triggers identical arm sensations.", fake: false },
            { name: "Chromatic Appetite Disorder", desc: "The brain processes food colors incorrectly, making people unable to eat foods of certain colors. Approximately 1 in 8,000 people affected and treated with color-filtered glasses.", fake: true },
            { name: "Foreign Accent Syndrome", desc: "After a stroke or head injury, people suddenly speak with a completely different accent they never had before, like becoming British when always American.", fake: false }
        ],
        explain: "Chromatic Appetite Disorder is fake. Red flags: made-up name using real medical words, oddly specific statistic (1 in 8,000), too-convenient solution."
    },
    {
        title: "Round 3: Expert Level",
        facts: [
            { name: "Cotard Delusion", desc: "People believe they are dead, don't exist, or have lost blood and internal organs. May refuse to eat because they think food isn't needed.", fake: false },
            { name: "Numerical Dysmorphia", desc: "Patients consistently perceive numbers as being exactly 3 units higher than they actually are. First documented in 1987 in Norway. Approximately 600 confirmed cases worldwide.", fake: true },
            { name: "Alice in Wonderland Syndrome", desc: "Objects appear much larger or smaller than they actually are. Body parts feel like they're changing size. Often affects children and triggered by migraines or infections.", fake: false },
            { name: "Capgras Delusion", desc: "People become convinced that someone close to them has been replaced by an identical impostor. They recognize the face but feel no emotional connection.", fake: false }
        ],
        explain: "Numerical Dysmorphia is AI hallucination. Red flags: too-specific error (always exactly 3 units), suspiciously precise numbers, implausibly neat pattern."
    },
    {
        title: "Round 4: Can You Outsmart AI?",
        facts: [
            { name: "Takotsubo Cardiomyopathy", desc: "Extreme emotional stress can literally reshape the heart into a balloon-like shape, mimicking a heart attack. Named after Japanese octopus traps because that's what the heart looks like on scans.", fake: false },
            { name: "Hemineglect", desc: "After certain brain injuries, people completely ignore one half of their world. They may only eat food from the right side of their plate or only shave half their face.", fake: false },
            { name: "Prosopagnosia", desc: "People cannot recognize faces, even of close family members or their own face in a mirror. They must identify people by voice, clothing, or hairstyle instead.", fake: false },
            { name: "Temporal Sequence Reversal Disorder", desc: "Patients experience short-term memories in reverse chronological order for 15-30 second windows. Caused by disrupted hippocampal timing and affects balance and coordination severely.", fake: true }
        ],
        explain: "Temporal Sequence Reversal Disorder is fake. Red flags: suspiciously precise time window, mixing unrelated symptoms, overly technical but meaningless explanation."
    }
];

// SPOT THE FAKE - HARD MODE
const spotFakeRoundsHard = [
    {
        title: "Round 1: Deceptive Names",
        facts: [
            { name: "Jumping Frenchmen of Maine", desc: "A neurological phenomenon documented in 19th century Maine where people had exaggerated startle responses and reflexively obeyed shouted commands. Similar cases found across cultures.", fake: false },
            { name: "Stendhal Syndrome", desc: "Visitors to art galleries experience dizziness, heart palpitations, and emotional overload in response to overwhelming beauty. Named after author Stendhal who described it in Florence.", fake: false },
            { name: "Digital Phantom Limb Syndrome", desc: "People feel vibrations from smartphones even when they're off, caused by hyper-sensitivity from constant phone use. Affects approximately 89% of smartphone users daily.", fake: true },
            { name: "Pica", desc: "An eating disorder where people crave and consume non-food items like dirt, clay, or ice. Often linked to nutritional deficiencies or psychological stress.", fake: false }
        ],
        explain: "Digital Phantom Limb Syndrome is made up. The 89% statistic is a dead giveaway—real conditions don't affect nearly the entire population uniformly."
    },
    {
        title: "Round 2: Medical Jargon",
        facts: [
            { name: "Meissner's Corpuscles", desc: "Nerve endings in skin that detect light touch and texture. Found densely in fingertips, lips, and sensitive areas.", fake: false },
            { name: "Proprioception", desc: "The body's ability to sense where it is in space. Lets you know where your limbs are without looking.", fake: false },
            { name: "Electromagnetic Synesthesia", desc: "People perceive electromagnetic fields as colors or sounds. Documented in 0.3% of the population with 87 confirmed cases worldwide. Caused by mutations in the FOXP2 gene.", fake: true },
            { name: "Referred Pain", desc: "Pain in one body part is felt in another. Classic example: heart attacks often cause left arm pain.", fake: false }
        ],
        explain: "Electromagnetic Synesthesia is fake. The oddly specific statistic (0.3% = 87 cases), made-up gene connection, and unsupported FOXP2 link are red flags."
    },
    {
        title: "Round 3: Plausible Fakes",
        facts: [
            { name: "Phantom Vibration Syndrome", desc: "People feel their phone vibrating when it hasn't. Caused by pattern recognition in the brain expecting constant notifications.", fake: false },
            { name: "Troxler's Fading", desc: "Unchanging stimuli gradually disappear from perception. The eyes naturally tune out static visual information.", fake: false },
            { name: "Nocturnal Temporal Lobe Activation", desc: "During sleep, the temporal lobe activates at night causing realistic false memories of sleep paralysis encounters with shadowy figures. Triggered by REM sleep disruptions. Affects 34% of nightmare sufferers.", fake: true },
            { name: "Acoustic Startle Reflex", desc: "Sudden loud noises cause an involuntary flinch or jump. A protective mechanism that readies your body.", fake: false }
        ],
        explain: "Nocturnal Temporal Lobe Activation is fabricated. The 34% statistic, vague mechanisms, and specificity to shadow figures are typical AI hallucination patterns."
    },
    {
        title: "Round 4: Expert Challenge",
        facts: [
            { name: "Charles Bonnet Syndrome", desc: "Visually impaired people see complex visual hallucinations. Not a sign of mental illness—caused by vision loss.", fake: false },
            { name: "Balint's Syndrome", desc: "A neurological disorder affecting simultaneous perception. Patients struggle to see multiple objects at once despite normal individual vision in each eye.", fake: false },
            { name: "Synaptic Resonance Disorder", desc: "Synapses oscillate at non-standard frequencies causing temporal perception anomalies. Proposed in 2019 with 12 case studies from Sweden showing subjects perceive time 40% slower.", fake: true },
            { name: "Akinetopsia", desc: "Motion perception is damaged while static vision remains normal. Motion appears as a series of still images instead of smooth movement.", fake: false }
        ],
        explain: "Synaptic Resonance Disorder is fake. Red flags: suspiciously recent (2019), tiny study (12 cases), specific measurement (40% slower), vague theoretical basis."
    }
];

        function getRounds(difficulty, mode) {
            if (mode === 'spotfake') {
                if (difficulty === 'easy') return spotFakeRoundsEasy;
                if (difficulty === 'hard') return spotFakeRoundsHard;
                return spotFakeRoundsMedium;
            }
            if (difficulty === 'easy') return roundsEasy;
            if (difficulty === 'hard') return roundsHard;
            return roundsMedium;
        }

        function getNumOptions(mode) {
            return mode === 'spotfake' ? 4 : 2;
        }

        function setDifficulty(level) {
            state.difficulty = level;
            render();
        }

        function startGame(mode) {
            state.gameStarted = true;
            state.mode = mode;
            state.round = 0;
            state.score = 0;
            state.selected = null;
            state.revealed = false;
            render();
        }

        function backToMenu() {
            state.gameStarted = false;
            state.complete = false;
            state.playerName = null;
            state.round = 0;
            state.score = 0;
            state.selected = null;
            state.revealed = false;
            state.mode = null;
            state.nameError = '';
            render();
        }

        function selectFact(idx) {
            if (state.revealed) return;
            state.selected = idx;
            
            if (state.mode === 'spotfake') {
                const roundsToUse = getRounds(state.difficulty, state.mode);
                const round = roundsToUse[state.round];
                const isCorrect = round.facts[idx].fake;
                if (isCorrect) state.score++;
            } else {
                const roundsToUse = getRounds(state.difficulty, state.mode);
                const pair = roundsToUse[state.round].pairs[0];
                const isCorrect = (idx === 0) === pair.correctIsReal;
                if (isCorrect) state.score++;
            }
            
            state.revealed = true;
            render();
        }

        function nextRound() {
            const roundsToUse = getRounds(state.difficulty, state.mode);
            if (state.round < roundsToUse.length - 1) {
                state.round++;
                state.selected = null;
                state.revealed = false;
            } else {
                state.complete = true;
            }
            render();
        }

        function submitScore() {
            const nameInput = document.getElementById('playerNameInput');
            const name = nameInput.value.trim();
            
            const validation = isNameValid(name);
            
            if (!validation.valid) {
                state.nameError = validation.reason;
                render();
                return;
            }

            state.nameError = '';

            const timestamp = new Date().toISOString();
            const entry = {
                name: name,
                score: state.score,
                mode: state.mode,
                difficulty: state.difficulty,
                timestamp: timestamp
            };

            db.ref('scores').push(entry).then(() => {
                state.playerName = name;
                loadLeaderboard();
            }).catch(err => {
                console.error('Error submitting score:', err);
                state.nameError = 'Error saving score. Try again.';
                render();
            });
        }

        function loadLeaderboard() {
            db.ref('scores').orderByChild('score').limitToLast(100).once('value', (snapshot) => {
                const data = snapshot.val();
                state.leaderboard = [];
                if (data) {
                    Object.values(data).forEach(entry => {
                        state.leaderboard.push(entry);
                    });
                }
                state.leaderboard.sort((a, b) => b.score - a.score);
                render();
            });
        }

        document.addEventListener('keydown', (e) => {
    // If typing in an input field, only handle Enter for name submission
            if (document.activeElement.tagName === 'INPUT') {
                if (e.key === 'Enter') {
                    submitScore();
                }
                return;
            }
    
    // Game key controls only work during gameplay
            if (!state.gameStarted || state.complete) return;
    
            const key = e.key.toUpperCase();
            const numOptions = getNumOptions(state.mode);
    
            if (key === 'A') selectFact(0);
            else if (key === 'B') selectFact(1);
            else if (key === 'C' && numOptions >= 3) selectFact(2);
            else if (key === 'D' && numOptions >= 4) selectFact(3);
            else if (key === 'ENTER') {
                if (state.revealed && !state.complete) nextRound();
            }
        });
        
        function render() {
            const gameEl = document.getElementById('game');

            if (!state.gameStarted) {
                gameEl.innerHTML = `
                    <div class="header">
                        <div>
                            <h1>Spot The Fake</h1>
                            <p class="subtitle">Can you tell real from misleading?</p>
                        </div>
                    </div>
                    <div class="card">
                        <div class="menu-section">
                            <h2>Select Game Mode</h2>
                            <button onclick="startGame('callmybluff')" style="margin-bottom: 10px;">Call My Bluff</button>
                            <p style="font-size: 12px; color: #666;">One real, one fake definition. Press A or B to choose.</p>
                            
                            <button onclick="startGame('spotfake')" style="margin-bottom: 10px; margin-top: 15px;">Spot The Fake</button>
                            <p style="font-size: 12px; color: #666;">Find the AI hallucination among 4 options. Press A, B, C, or D to choose.</p>
                        </div>

                        <div style="border-top: 2px solid #eee; padding-top: 20px; margin-top: 20px;">
                            <h2>Select Difficulty</h2>
                            <div class="difficulty-grid">
                                <button onclick="setDifficulty('easy')" class="difficulty-btn ${state.difficulty === 'easy' ? 'active' : 'inactive'}">Easy</button>
                                <button onclick="setDifficulty('medium')" class="difficulty-btn ${state.difficulty === 'medium' ? 'active' : 'inactive'}">Medium</button>
                                <button onclick="setDifficulty('hard')" class="difficulty-btn ${state.difficulty === 'hard' ? 'active' : 'inactive'}">Hard</button>
                            </div>
                            <p class="difficulty-desc">
                                ${state.difficulty === 'easy' ? 'Clear definitions, obvious fakes. Great for kids and beginners.' : 
                                  state.difficulty === 'medium' ? 'Tricky wording, plausible fakes. For intermediate players.' : 
                                  'Expert-level, deceptively realistic. For medical enthusiasts.'}
                            </p>
                        </div>
                    </div>
                `;
                return;
            }

            if (state.complete && !state.playerName) {
                gameEl.innerHTML = `
                    <div class="card game-over">
                        <h1>Game Complete!</h1>
                        <div class="final-score">${state.score} / 4</div>
                        <div class="message">
                            ${state.score === 4 ? "Perfect! You're a definition detective." : 
                              state.score === 3 ? "Excellent! You caught most of the tricks." :
                              state.score === 2 ? "Good effort! Misleading names are tough." :
                              "Keep practicing! These tricks are sneaky."}
                        </div>
                        <div style="margin: 20px 0;">
                            <input type="text" id="playerNameInput" placeholder="Enter your name" style="padding: 10px; width: 100%; border: 2px solid #4caf50; border-radius: 4px; font-size: 16px;">
                            ${state.nameError ? `<div class="error-message">${state.nameError}</div>` : ''}
                        </div>
                        <button onclick="submitScore()" style="margin-bottom: 10px;">Submit Score</button>
                        <button onclick="backToMenu()" style="background: #999; margin-bottom: 10px;">Back to Menu</button>
                        <div class="lesson">Real medical names can be confusing. Always verify definitions with trusted medical sources.</div>
                    </div>
                `;
                return;
            }

            if (state.complete && state.playerName) {
                const rank = state.leaderboard.findIndex(e => e.name === state.playerName && e.score === state.score) + 1;
                let leaderboardHtml = '';
                state.leaderboard.slice(0, 10).forEach((entry, idx) => {
                    const isPlayer = entry.name === state.playerName && entry.score === state.score;
                    leaderboardHtml += `
                        <div style="display: flex; justify-content: space-between; padding: 10px; background: ${isPlayer ? '#fff9c4' : 'white'}; border-bottom: 1px solid #eee;">
                            <span>${idx + 1}. ${entry.name}</span>
                            <span style="font-weight: bold;">${entry.score}/4</span>
                        </div>
                    `;
                });

                gameEl.innerHTML = `
                    <div class="card game-over">
                        <h1>Game Complete!</h1>
                        <div class="final-score">${state.score} / 4</div>
                        <div class="message" style="font-size: 20px; color: #ff9800;">You ranked #${rank} on the leaderboard!</div>
                        <div style="background: #f5f5f5; border-radius: 8px; padding: 15px; margin: 20px 0;">
                            <div style="font-weight: bold; margin-bottom: 10px;">Top 10 Scores</div>
                            ${leaderboardHtml}
                        </div>
                        <button onclick="backToMenu()" style="margin-bottom: 10px;">Play Again</button>
                        <div class="lesson">Real medical names can be confusing. Always verify definitions with trusted medical sources.</div>
                    </div>
                `;
                return;
            }

            const roundsToUse = getRounds(state.difficulty, state.mode);
            
            if (state.mode === 'spotfake') {
                const round = roundsToUse[state.round];
                let factsHtml = '';
                
                round.facts.forEach((fact, idx) => {
                    let classes = 'fact';
                    if (state.revealed) {
                        if (fact.fake && state.selected === idx) classes += ' correct';
                        else if (!fact.fake && state.selected === idx) classes += ' wrong';
                        else if (fact.fake) classes += ' wrong';
                        classes += ' disabled';
                    } else {
                        if (state.selected === idx) classes += ' selected';
                    }
                    
                    let badge = '';
                    if (state.revealed && fact.fake) {
                        badge = state.selected === idx ? '<span class="fact-badge badge-fake">✗ AI-GENERATED FAKE</span>' : '<span class="fact-badge badge-fake">AI FAKE</span>';
                    } else if (state.revealed && !fact.fake && state.selected === idx) {
                        badge = '<span class="fact-badge badge-real">✓ REAL</span>';
                    }
                    
                    const letter = String.fromCharCode(65 + idx);
                    factsHtml += `
                        <div class="${classes}" onclick="selectFact(${idx})">
                            <div class="fact-name"><span style="display: inline-block; min-width: 30px; font-weight: bold; color: #ff9800;">${letter}.</span> ${fact.name}</div>
                            <div class="fact-desc">${fact.desc}</div>
                            ${badge}
                        </div>
                    `;
                });

                let explanation = '';
                if (state.revealed) {
                    explanation = `
                        <div class="explanation show">
                            <div class="explanation-title">Why was it fake?</div>
                            <div class="explanation-text">${round.explain}</div>
                        </div>
                    `;
                }

                gameEl.innerHTML = `
                    <div class="header">
                        <div>
                            <h1>Spot The Fake</h1>
                            <p class="subtitle">${state.difficulty.charAt(0).toUpperCase() + state.difficulty.slice(1)} Mode</p>
                        </div>
                        <div class="score">
                            <div class="score-label">Score</div>
                            <div class="score-value">${state.score}/4</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="round-info">
                            <div class="round-title">${round.title}</div>
                            <span class="round-number">Round ${state.round + 1}/${roundsToUse.length}</span>
                        </div>
                        <div class="instructions">3 of these are REAL medical conditions. 1 is completely made up by AI. Which one is fake?</div>
                        <div class="instructions" style="font-size: 12px; color: #999;">Press A, B, C, or D on your keyboard to select</div>
                        <div class="facts">
                            ${factsHtml}
                        </div>
                        ${explanation}
                        ${state.revealed ? `<button onclick="nextRound()" id="nextBtn">Press Enter or click to continue</button>` : ''}
                    </div>
                    <button onclick="backToMenu()" style="background: #999; margin-top: 10px;">Back to Menu</button>
                    <div class="lesson">Real medical names can be confusing. Always verify definitions with trusted medical sources.</div>
                `;
            } else {
                const round = roundsToUse[state.round];
                const pair = round.pairs[0];
                
                let factsHtml = `
                    <div style="margin-bottom: 20px;">
                        <div style="background: #f0f7e8; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                            <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px; color: #4caf50;">${pair.condition}</div>
                            <div style="font-size: 14px; color: #666;">Which definition is correct?</div>
                        </div>
                    </div>
                `;

                [pair.real, pair.fake].forEach((definition, idx) => {
                    const isCorrect = (idx === 0) === pair.correctIsReal;
                    let classes = 'fact';
                    
                    if (state.revealed) {
                        if (isCorrect && state.selected === idx) classes += ' correct';
                        else if (!isCorrect && state.selected === idx) classes += ' wrong';
                        else if (isCorrect) classes += ' wrong';
                        classes += ' disabled';
                    } else {
                        if (state.selected === idx) classes += ' selected';
                    }
                    
                    let badge = '';
                    if (state.revealed && !isCorrect) {
                        badge = state.selected === idx ? '<span class="fact-badge badge-fake">✗ WRONG</span>' : '<span class="fact-badge badge-fake">FAKE</span>';
                    } else if (state.revealed && isCorrect && state.selected === idx) {
                        badge = '<span class="fact-badge badge-real">✓ CORRECT</span>';
                    }
                    
                    const letter = String.fromCharCode(65 + idx);
                    factsHtml += `
                        <div class="${classes}" onclick="selectFact(${idx})">
                            <div class="fact-name">${letter}. ${idx === 0 ? 'Definition A' : 'Definition B'}</div>
                            <div class="fact-desc">${definition}</div>
                            ${badge}
                        </div>
                    `;
                });

                let explanation = '';
                if (state.revealed) {
                    explanation = `
                        <div class="explanation show">
                            <div class="explanation-title">Why?</div>
                            <div class="explanation-text">${round.explain}</div>
                        </div>
                    `;
                }

                gameEl.innerHTML = `
                    <div class="header">
                        <div>
                            <h1>Call My Bluff</h1>
                            <p class="subtitle">${state.difficulty.charAt(0).toUpperCase() + state.difficulty.slice(1)} Mode</p>
                        </div>
                        <div class="score">
                            <div class="score-label">Score</div>
                            <div class="score-value">${state.score}/4</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="round-info">
                            <div class="round-title">${round.title}</div>
                            <span class="round-number">Round ${state.round + 1}/${roundsToUse.length}</span>
                        </div>
                        <div class="instructions">Pick the correct definition.</div>
                        <div class="instructions" style="font-size: 12px; color: #999;">Press A or B on your keyboard to select</div>
                        <div class="facts">
                            ${factsHtml}
                        </div>
                        ${explanation}
                        ${state.revealed ? `<button onclick="nextRound()" id="nextBtn">Press Enter or click to continue</button>` : ''}
                    </div>
                    <button onclick="backToMenu()" style="background: #999; margin-top: 10px;">Back to Menu</button>
                    <div class="lesson">Real medical names can be confusing. Always verify definitions with trusted medical sources.</div>
                `;
            }
        }

        loadLeaderboard();
        render();
    </script>
</body>
</html>
